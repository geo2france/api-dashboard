# API-Dashboard

Collection de composants React pour faciliter la cr√©ation de **tableaux de bords territoriaux**.

Le projet permet la mise en place d'un tableau de bord facile √† d√©ployer sur une **infrastucture l√©g√®re**.
Le tableau de bord, une fois compil√©, peut-√™tre mis √† disposition des utilisateurs via un **simple server web** (HTTP/HTTPS) sans configuration particuli√®re.
Il s'agit d'une application React (Javascript) s'executant dans le navigateur des utilisateurs. Il n'y a pas **backend √† installer**,
l'application r√©cup√®re les donn√©es via API **aupr√®s d'un partenaire** (plateforme r√©gionale, portail open-data, etc.) ou sur **votre serveur de donn√©es**.
Les donn√©es sont ensuites trait√©es par le client et pr√©sent√©es √† l'utilisateur via des graphiques ou cartes.

Si des donn√©es sensibles alimentent un tableau de bord, l'authentification et la s√©curit√© sont g√©r√©es au niveau du serveur de donn√©es. C'est donc 
lui qui va s'assurer que l'utilisateur a un droit d'acc√®s aux donn√©es. L'application peut donc tout √™tre utilis√©e pour pr√©senter
des donn√©es sensibles ou m√™me des graphiques dont les donn√©es diff√®rent selon les droits de l'utilisateur.

Les API suivantes sont actuellement support√©es (interrogation, filtre, pagination, etc. ) :
- [WFS](src/data_providers/wfs/) : API propos√©e par la plupart des serveurs geographiques (QGIS Server, GeoServer, ArcGIS server, etc.)
- [Data Fair](src/data_providers/datafair/) : API de la solution open source Data Fair.
- En d√©veloppement : OGC API Features, TJS

![diag](architecture_1.png)

En bref : 

- ‚úÖ D√©ploiement facile et rapide (_client side_)
- ‚úÖ Pr√©sentez au m√™me endroit des donn√©es tierces, vos donn√©es et celles de vos partenaires
- ‚úÖ Possibilit√© de visualiser des donn√©es sensibles
- ‚úÖ Flexibilit√©

Les composants sont actuellement utilis√©s pour le [tableau de bord de l'Odema](https://github.com/geo2france/odema-dashboard).


## Utilisation

### Approche d√©clarative

Le tableau de bord est construit de mani√®re d√©clarative **JSX** (accronyme de JavaScript XML).
Comme son nom l'indique, il permet de combiner la clart√© et l'efficacit√© du XML, avec la souplesse et la puissance du JavaScript.

La construction du tableau de bord repose sur l'articulation de 3 grands concepts :

- Les `<Dataset>` permettent de rappatrier, filter et traiter laes donn√©es depuis des sources distantces (un portail open-data par exemple)
- Les graphiques `<ChartXXX>` et `<MapXXX>` constituent la partie essentiel du tableau de bord
- Les `<Control>` pour que les utilisateurs puissent interragir avec le tableau de bord (filter, activer/d√©sactiver une option, etc.)

Il est possible d'ajouter des √©l√©ments dynamiques en Javascript.

```jsx
<Dashboard>

  <Dataset 
        id="dma_collecte_traitement" 
        resource="sinoe-(r)-destination-des-dma-collectes-par-type-de-traitement/lines"
        url="https://data.ademe.fr/data-fair/api/v1/datasets"
        type="datafair"
        pageSize={5000}>
        <Filter field="L_REGION">Hauts-de-France</Filter> 
        {/* Un filtre statique appliqu√© √† l'API qui fournie les donn√©es */}

        <Filter field="ANNEE">{useControl('annee')}</Filter> 
        {/* Un second filtre : l'ann√©e choisie par l'utilisateur */}

        <Transform>SELECT [ANNEE], [L_TYP_REG_DECHET],  SUM([TONNAGE_DMA]) as [TONNAGE_DMA] FROM ? GROUP BY [ANNEE], [L_TYP_REG_DECHET]</Transform> 
        {/* Transformation local des donn√©es */}

        <Producer url="https://odema-hautsdefrance.org/">Odema</Producer>
        {/* Pour cr√©diter les graphiques */}
  </Dataset>

  <Control>
      <NextPrevSelect name="annee" options={[{label:'2021', value:2021},{label:'2019', value:2019}]} />
  </Control>
  {/* Un control permettant √† mon utilisateur de choisir l'ann√©e */}

  <ChartPie title={`Tonnages de d√©chets en ${useControl('annee')}`} dataset='dma_collecte_traitement' nameKey='L_TYP_REG_DECHET' dataKey='TONNAGE_DMA' />
  {/* Un graphique camembert standard. J'indique mon jeu de donn√©es et les colonnes √† utiliser */}

</Dashboard>
```



### D√©veloppement de composant dataviz

La biblioth√®que propose des graphiques de bases, mais il possible de d√©velopper ses propres composants React.
Des fonctions sont propos√©s afin d'aider le d√©veloppeur dans cette t√¢che : acc√©der facilement aux donn√©es ou aux options utilisateurs, gestion des erreurs, etc.

Le d√©veloppeur est libre d'utiliser biblioth√®que dataviz ou carto de son choix, √† partir du moment o√π le composant retourne un √©l√©ment visuelle.
Nous pr√©conisons [Echarts](https://echarts.apache.org) ou [Recharts](https://recharts.org/), mais il en existe une multitude.

`TODO : guide d√©veloppement compsoant`

## Installation

Version de d√©veloppment :
`npm install https://github.com/geo2france/api-dashboard/tarball/dev`

Version stable :
`npm install https://github.com/geo2france/api-dashboard/tarball/main`

## Documentation 

‚≠ê Essentiel  
üë®‚Äçüíª Utilisateur avanc√© 

### Mise en page et structure

- [DashboardApp](/src/components/Layout/) ‚≠ê
- [DashboardPage](/src/components/DashboardPage/) ‚≠ê
- [DashboardElement](/src/components/DashboardElement/) ‚≠ê


### Composants 

- [KeyFigure](/src/components/KeyFigure/) ‚≠ê
- [NextPrevSelect](/src/components/NextPrevSelect/) ‚≠ê
- [MapLegend](/src/components/MapLegend/) ‚≠ê
- [FlipCard](/src/components/FlipCard/)
- [LoadingContainer](/src/components/LoadingContainer/)

### Hooks et fonctions

- [useApi](/src/utils/README.MD) ‚≠ê
- [useSearchParamsState](/src/utils/README.MD) ‚≠ê
- [useChartEvents](/src/utils/README.MD) üë®‚Äçüíª
- [useChartActionHightlight](/src/utils/README.MD) üë®‚Äçüíª
- [useMapControl](/src/utils/README.MD) üë®‚Äçüíª
- [useChartExport](/src/utils/README.MD)

### Fournisseur de donn√©es

- [WFS](/src/data_providers/wfs/) ‚≠ê
- [Datafair](/src/data_providers/datafair/) ‚≠ê
- [Filte](/src/data_providers/file/) ‚≠ê

![block-graph](block-graph.png)

<!---
```mermaid
graph TD; 

subgraph "&lt;DashboardApp&gt;"
  subgraph "&lt;DashboardPage&gt;" 
    subgraph "&lt;DashboardElement&gt;" 
        subgraph "Chart(Echart)" 
        end
    end
    subgraph "&lt;DashboardElement&gt;" 
        subgraph "Chart(Echart)" 
        end
    end
        subgraph "&lt;DashboardElement&gt;" 
        subgraph "Chart(Echart)" 
        end
    end
  end

  subgraph "&lt;DashboardPage&gt;" 
    subgraph "&lt;DashboardElement&gt;" 
        subgraph "Chart(Echart)" 
        end
    end
    subgraph "&lt;DashboardElement&gt;" 
        subgraph "Chart(Echart)" 
        end
    end
        subgraph "&lt;DashboardElement&gt;" 
        subgraph "Chart(Echart)" 
        end
    end
  end
end  
```
--->